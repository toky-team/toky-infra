##### Listen
http_port 3128

##### ACLs
# 내부망(앱노드) CIDR
acl localnet src 10.0.0.0/16

# 모든 포트 허용(막힘 없이 통과). 순서 제어용
acl Safe_ports port 1-65535
acl SSL_ports  port 1-65535
acl CONNECT method CONNECT

# 민감/로컬 보호 (기존 이름과 충돌 피하려 새 이름 사용)
acl deny_imds      dst 169.254.169.254/32
acl deny_localhost dst 127.0.0.0/8 ::1
acl deny_linklocal dst 169.254.0.0/16

##### Access rules (순서 중요)
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

# 내부 보호
http_access deny deny_localhost
http_access deny deny_linklocal
http_access deny deny_imds

# 내부망은 전부 허용 (도메인 화이트리스트 없이)
http_access allow localnet

# 그 외 차단(오픈 프록시 방지)
http_access deny all

##### Privacy
forwarded_for off
via on

##### Caching off (리소스 최소화)
cache deny all
memory_cache_mode never
maximum_object_size 0 KB

##### Logging / Core
access_log stdio:/var/log/squid/access.log
coredump_dir /var/spool/squid
