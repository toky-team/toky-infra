:80 {
  @health path /health
  handle @health {
    respond 200
  }

  # front = 루트 도메인
  @front host toky.devkor.club
  handle @front {
    root * /srv/front/current
    encode gzip zstd
    try_files {path} /index.html
    file_server
    @front_assets path *.js *.css *.png *.jpg *.svg *.webp *.webmanifest *.ico
    header @front_assets Cache-Control "public, max-age=31536000, immutable"
  }

  # admin 정적
  @admin host admin.toky.devkor.club
  handle @admin {
    root * /srv/admin/current
    encode gzip zstd
    try_files {path} /index.html
    file_server
    @admin_assets path *.js *.css *.png *.jpg *.svg *.webp *.webmanifest *.ico
    header @admin_assets Cache-Control "public, max-age=31536000, immutable"
  }

  # 모니터링 (Grafana/Prometheus)
  @grafana host monitor.toky.devkor.club
  handle @grafana {
    route {
      handle /grafana* {
        reverse_proxy grafana:3000 {
          header_up Host {host}
          header_up X-Forwarded-Proto {scheme}
          header_up X-Forwarded-Prefix /grafana
        }
      }
      handle /prometheus* {
        reverse_proxy prometheus:9090 {
          header_up Host {host}
          header_up X-Forwarded-Proto {scheme}
          header_up X-Forwarded-Prefix /prometheus
        }
      }
      respond 404
    }
  }

  # 기타 404
  respond 404
}
